<!DOCTYPE html>
<html lang="en">
<head>
    <title>DMDB</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <link rel="stylesheet" href="index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"/>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/css/bootstrap-slider.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/bootstrap-slider.min.js"></script>
   </head>
<body>
<div id="app">
<!--
    TEMPLATES
    TEMPLATES
    TEMPLATES
-->

    <!--
        TAGS
    -->
    <script type='text/x-template' id='tags'>
        <div class="column-container">
            <b-input-group v-for="(row, index) in modelvar.rows">
                <b-form-tags input-id="tags-pills" v-model="modelvar.rows[index]" tag-variant="secondary" tag-pills size="sm" remove-on-delete :placeholder="(row && row.length > 0 ) ? '' : 'Name, race, effect...'"/> 
                <b-input-group-append>
                    <b-button @click="addrow(index)" size="sm" :variant="(modelvar && ((index + 1) == modelvar.rows.length)) ? 'secondary' : 'danger'">{{ (modelvar.rows && ((index + 1) == modelvar.rows.length)) ? '+' : 'X' }}</b-button>
                </b-input-group-append>
            </b-input-group>
        </div>
    </script>

    <!--
        PICKER
    -->
    <script type='text/x-template' id='picker'>
        <div class="picker-container">
            <b-form-checkbox pill class="picker-item" v-for="opt in opts" @change="conflict(opt.value)" v-model="modelvar[opt.value]" name="whatever" :size="opt.size" button squared :button-variant="opt.variant"><font size="1">{{opt.text}}</font></b-form-checkbox>
        </div>
    </script>

    <!--
        SLIDER
    -->

    <script type='text/x-template' id='slider'>
        <div class="paddin-column-container">
            <div class="slider-title">
                <div class="first-slider-badge">
                    <b-badge pill>{{ Math.min(modelvar.lower, modelvar.upper) }}</b-badge>
                </div>
                <div class="second-slider-badge">
                    <b-badge>{{ title }}</b-badge>
                </div>
                <div class="third-slider-badge">
                    <b-badge pill>{{ Math.max(modelvar.lower, modelvar.upper) }}</b-badge>
                </div>
            </div>
            <div class="slider-proper">
                <b-form-input ref="background_slider" class="corer" style="position: absolute; z-index: 1;" type="range" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
                <b-form-input class="thumb" @input="update()" style="position: absolute; z-index: 2;" type="range" v-model="modelvar.lower" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
                <b-form-input class="thumb" @input="update()" style="position: absolute; z-index: 3;" type="range" v-model="modelvar.upper" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
            </div>
        </div>
    </script>

    <!--
        TOTALBADGE
    -->
    <script type='text/x-template' id='totalbadge'>
        <b-badge class="totalbdg" :variant="badgevariant">
            <slot></slot>
            {{ getcards() ? Object.entries(getcards()).reduce((total, [name, count]) => total + (applicable && applicable.indexOf(name.toLowerCase()) !== -1 ? count : 0), 0) : "" }}
        </b-badge>
    </script>

<!--
    END TEMPLATES
    END TEMPLATES
    END TEMPLATES
-->

    <div id="site">

        <div id="side">
            <div id="queries">

                <picker :modelvar="searchtypemodel" :opts="searchtypes"></picker>
                
                <div id="taggroup" class="query">
                    <tags :modelvar="tagsmodel"/>
                </div>

                <div class="query pickem">
                    <picker :modelvar="civmodel" :opts="civs"></picker>

                    <div class="pickem-down">
                        <picker :modelvar="typmodel" :opts="types"></picker>
                        <picker :modelvar="civtypmodel" :opts="civtypes"></picker>
                    </div>
                </div>

                <div class="query">
                    <slider class="sliderman" :modelvar="costmodel" title="COST" :points="cost_points"></slider>
                
                    <slider class="sliderman" :modelvar="powermodel" title="POWER" :points="power_points"></slider>

                    <slider class="sliderman" :modelvar="setmodel" title="SET" :points="set_points"></slider>
                </div>

                <div style="display: flex; justify-content: center; padding: 5px;">
                    <b-button square @click="reset()" id="reset-button"></b-button>
                </div>
            </div>

            <div id="deck">
                <div id="totals">
                    <div class="subtotals-total">
                        <totalbadge :getcards="deck_cards" badgevariant="" :testf="_ => true"></totalbadge>
                    </div>
                    <div class="subtotals">
                        <totalbadge :getcards="deck_cards" badgevariant="danger" :testf="({'civilization': civs}) => civs.indexOf('fire') !== -1"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="dark" :testf="({'civilization': civs}) => civs.indexOf('darkness') !== -1"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="primary" :testf="({'civilization': civs}) => civs.indexOf('water') !== -1"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="success" :testf="({'civilization': civs}) => civs.indexOf('nature') !== -1"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="warning" :testf="({'civilization': civs}) => civs.indexOf('light') !== -1"></totalbadge>
                    </div>
                    <div class="subtotals">
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="({'effect': effects}) => effects.some(eff => eff.startsWith('shield trigger ('))"><img src="icons/shieldtrigger.png"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="({'effect': effects}) => effects.some(eff => eff.startsWith('blocker ('))"><img src="icons/blocker.png"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="({'effect': effects}) => effects.some(eff => eff.startsWith('evolution:'))"><img src="icons/evolutioncreature.png"></totalbadge>
                    </div>
                </div>
                <textarea id="decktext" v-model="deck.text" rows="20"></textarea>
                <div id="deckbuttons">
                    <b-button square v-on:click="deck.text = ''">CLEAR</b-button>
                </div>
            </div>

        </div>

        <div id="cards">
            <div class="card-container" v-for="card in queried_cards" :style="'height: ' + (307 + 20 * (card.count - 1)) + 'px'" v-on:click="add_card(card.name)" @contextmenu="$event.preventDefault(); remove_card(card.name)">
                <img v-for="i in [...Array(card.count).keys()]" :style="'top: ' + (20 * i) + 'px; z-index: ' + i" class="card-image" :alt="card.name" :src="'dm_images/' + card.name + '.jpg'">
            </div>
        </div>

    </div>
</div>

    <script src="index.js"></script>

</body>
</html>
