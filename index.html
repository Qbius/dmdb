<!DOCTYPE html>
<html lang="en">
<head>
    <title>DMDB</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <link rel="stylesheet" href="index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"/>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/css/bootstrap-slider.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.2/bootstrap-slider.min.js"></script>
   </head>
<body>
<div id="app">
<!--
    TEMPLATES
    TEMPLATES
    TEMPLATES
-->

    <!--
        TAGS
    -->
    <script type='text/x-template' id='tags'>
        <div class="column-container">
            <b-input-group v-for="(row, index) in rows">
                <b-form-tags input-id="tags-pills" v-model="modelvar.data.rows[index]" tag-variant="secondary" tag-pills size="sm" remove-on-delete :placeholder="(row && row.length > 0 ) ? '' : 'Name, race, effect...'"/> 
                <b-input-group-append>
                    <b-button @click="addrow(index)" size="sm" :variant="(((index + 1) == rows.length)) ? 'secondary' : 'danger'">{{ (((index + 1) == rows.length)) ? '+' : 'X' }}</b-button>
                </b-input-group-append>
            </b-input-group>
        </div>
    </script>

    <!--
        PICKER
    -->
    <script type='text/x-template' id='picker'>
        <div class="picker-container">
            <b-form-checkbox pill class="picker-item" v-for="opt in opts" @change="conflict(opt.value)" v-model="modelvar.data[opt.value]" name="whatever" :size="opt.size" button squared :button-variant="opt.variant"><font size="1">{{opt.text}}</font></b-form-checkbox>
        </div>
    </script>

    <!--
        SLIDER
    -->

    <script type='text/x-template' id='slider'>
        <div class="paddin-column-container">
            <div class="slider-title">
                <div class="first-slider-badge">
                    <b-badge pill>{{ modelvar.lower }}</b-badge>
                </div>
                <div class="second-slider-badge">
                    <b-badge>{{ title }}</b-badge>
                </div>
                <div class="third-slider-badge">
                    <b-badge pill>{{ modelvar.upper }}</b-badge>
                </div>
            </div>
            <div class="slider-proper">
                <b-form-input ref="background_slider" class="corer" :style="bgstyle + 'position: absolute; z-index: 1;'" type="range" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
                <b-form-input class="thumb" style="position: absolute; z-index: 2;" type="range" v-model="modelvar.data.lowerval" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
                <b-form-input class="thumb" style="position: absolute; z-index: 3;" type="range" v-model="modelvar.data.upperval" :min="points[0]" :max="points[1]" :step="points[2]"></b-form-input>
            </div>
        </div>
    </script>

    <!--
        TOTALBADGE
    -->
    <script type='text/x-template' id='totalbadge'>
        <b-badge v-if="always || count > 0" class="totalbdg" :variant="badgevariant">
            <slot></slot>
            {{ count }}
        </b-badge>
    </script>

<!--
    END TEMPLATES
    END TEMPLATES
    END TEMPLATES
-->

    <div id="site">

        <div id="side">
            <div id="queries">

                <div id="searchtype">
                    <picker :modelvar="searchtypemodel" :opts="searchtypes"></picker>
                </div>
                
                <div id="taggroup" class="query">
                    <tags :modelvar="models.tags"></tags>
                </div>

                <div class="query pickem">
                    <picker :modelvar="models.civ" :opts="civs"></picker>

                    <div class="pickem-down">
                        <picker :modelvar="models.typ" :opts="types"></picker>
                        <picker :modelvar="models.civtyp" :opts="civtypes"></picker>
                    </div>
                </div>

                <div class="query">
                    <slider class="sliderman" :modelvar="models.cost" title="COST" :points="cost_points"></slider>
                
                    <slider class="sliderman" :modelvar="models.power" title="POWER" :points="power_points"></slider>

                    <slider class="sliderman" :modelvar="models.set" title="SET" :points="set_points"></slider>
                </div>

                <div style="display: flex; justify-content: center;">
                    <b-button square @click="reset()" id="reset-button"></b-button>
                </div>
            </div>

            <div id="deck">
                <div id="totals">
                    <div id="civtotals">
                        <div id="tottotal-wrapper">
                            <div class="subtotals-total">
                                <totalbadge :always="true" :getcards="deck_cards" badgevariant="" :testf="_ => true"></totalbadge>
                            </div>
                        </div>
                        <div id="civtotal-wrapper">
                            <div class="subtotals">
                                <totalbadge :getcards="deck_cards" badgevariant="danger" :testf="({'civilization': civs}) => civs.indexOf('fire') !== -1"></totalbadge>
                                <totalbadge :getcards="deck_cards" badgevariant="dark" :testf="({'civilization': civs}) => civs.indexOf('darkness') !== -1"></totalbadge>
                                <totalbadge :getcards="deck_cards" badgevariant="primary" :testf="({'civilization': civs}) => civs.indexOf('water') !== -1"></totalbadge>
                                <totalbadge :getcards="deck_cards" badgevariant="success" :testf="({'civilization': civs}) => civs.indexOf('nature') !== -1"></totalbadge>
                                <totalbadge :getcards="deck_cards" badgevariant="warning" :testf="({'civilization': civs}) => civs.indexOf('light') !== -1"></totalbadge>
                            </div>
                        </div>
                    </div>
                    <div id="efftotals">
                        <totalbadge :always="true" :getcards="deck_cards" badgevariant="light" :testf="is.shield_trigger"><img src="icons/shieldtrigger.png"></totalbadge>
                        <totalbadge :always="true" :getcards="deck_cards" badgevariant="light" :testf="is.blocker"><img src="icons/blocker.png"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="is.evolution"><img src="icons/evolutioncreature.png"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="is.wave_striker"><img src="icons/wavestriker.png"></totalbadge>
                        <totalbadge :getcards="deck_cards" badgevariant="light" :testf="is.survivor"><img src="icons/survivor.png"></totalbadge>
                    </div>
                </div>
                <div id="decktextcontainer">
                    <textarea id="decktext" :style="'width: ' + el_property('decktextcontainer', 'width') + ';'" v-model="deck.text" rows="20"></textarea>
                    <div id="deckoverlay-container" :style="'width: ' + el_property('decktext', 'width') + '; height: ' + el_property('decktext', 'height') + ';'">
                        <div v-for="card in deck_lines" class="deckoverlay">
                            <div v-if="is_card(card) && is.shield_trigger(cardinfo(card))" class="deckoverlay-icon-wrapper"><img class="deckoverlay-icon" src="icons/shieldtrigger.png"></div>
                            <div v-if="is_card(card) && is.blocker(cardinfo(card))" class="deckoverlay-icon-wrapper"><img class="deckoverlay-icon" src="icons/blocker.png"></div>
                            <div v-if="is_card(card) && is.evolution(cardinfo(card))" class="deckoverlay-icon-wrapper"><img class="deckoverlay-icon" src="icons/evolutioncreature.png"><font size="1px">{{ evolution_baits_count(card).toString() }}</font></div>
                            <div v-if="is_card(card) && is.survivor(cardinfo(card))" class="deckoverlay-icon-wrapper"><img class="deckoverlay-icon" src="icons/survivor.png"></div>
                            <div v-if="is_card(card) && is.wave_striker(cardinfo(card))" class="deckoverlay-icon-wrapper"><img class="deckoverlay-icon" src="icons/wavestriker.png"></div>
                        </div>
                    </div>
                </div>
                <div id="deckbuttons">
                    <b-button square v-on:click="deck.text = ''">CLEAR</b-button>
                    <b-button square v-on:click="share_deck()">SHARE</b-button>
                </div>
                <textarea id="copier" style="display: none;"></textarea>
            </div>

        </div>

        <div id="cards">
            <div class="card-container" v-for="(card, index) in queried_cards" :key="card.name" :style="'height: ' + (307 + 20 * (Math.min(card.count, 4) - 1)) + 'px'" v-on:click="add_card(card.name)" @contextmenu="$event.preventDefault(); remove_card(card.name)">
                <img v-if="index < cards_shown" v-for="i in [...Array(Math.min(card.count, 4)).keys()]" :style="'top: ' + (20 * i) + 'px; z-index: ' + i" class="card-image" :alt="card.name" :src="card.image">
            </div>
        </div>
    </div>
</div>

    <script src="index.js"></script>

</body>
</html>
